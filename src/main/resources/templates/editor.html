<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" class="x-admin-sm" lang="en">
<head>
    <meta charset="UTF-8">
    <title>编辑文章</title>
    <!--        markdown-->
    <link rel="stylesheet" th:href="@{/assets/editormd/css/editormd.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/bootstrap.css}"/>
    <link rel="stylesheet" th:href="@{/css/bootstrap-theme.css}"/>

</head>
<body>
<div id="titleDiv">
    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text" id="basic-addon1">@</span>
        </div>
        <input type="text" name="title" id="title" class="form-control" placeholder="请输入文章标题" aria-label="Username"
               aria-describedby="basic-addon1">
    </div>
    <div>
        <button id="save" type="button" class="btn btn-outline-success">保存草稿</button>
        <button id="publish" type="button" class="btn btn-success">发布文章</button>
    </div>
</div>
<div id="editor">
    <!--                <textarea style="display:none;">### Hello Editor.md !</textarea>-->
    <textarea class="editormd-markdown-textarea" name="markdown-doc" id="editormd"></textarea>
    <!-- 第二个隐藏文本域，用来构造生成的HTML代码，方便表单POST提交，这里的name可以任意取，后台接受时以这个name键为准 -->
    <!-- html textarea 需要开启配置项 saveHTMLToTextarea == true -->
    <!--        <textarea class="editormd-html-textarea" name="editorhtml" id="editorhtml"></textarea>-->
</div>
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/assets/editormd/editormd.min.js}"></script>
<script type="text/javascript">
    $(function () {
        var editor = editormd("editor", {
            width: "90%",
            height: 640,
            codeFold: true,
            syncScrolling: "single",
            markdown: "xxxx",     // dynamic set Markdown text
            path: "/assets/editormd/lib/",  // Autoload modules mode, codemirror, marked... dependents libs path
            emoji: true,
            taskList: true,
            tocm: true,         // Using [TOCM]
            tex: true,                   // 开启科学公式TeX语言支持，默认关闭
            flowChart: true,             // 开启流程图支持，默认关闭
            sequenceDiagram: true,       // 开启时序/序列图支持，默认关闭,
            //这个配置在simple.html中并没有，但是为了能够提交表单，使用这个配置可以让构造出来的HTML代码直接在第二个隐藏的textarea域中，方便post提交表单。
            // saveHTMLToTextarea: true,

            // Editor.md theme, default or dark, change at v1.5.0
            // You can also custom css class .editormd-preview-theme-xxxx
            //这个是工具栏的主题设置
            // theme        : (localStorage.theme) ? localStorage.theme : "dark",
            // Preview container theme, added v1.5.0
            // You can also custom css class .editormd-preview-theme-xxxx
            //这个是预览的主题设置
            // previewTheme : (localStorage.previewTheme) ? localStorage.previewTheme : "dark",
            // Added @v1.5.0 & after version is CodeMirror (editor area) theme
            //这是编辑框的主题设置
            // editorTheme  : (localStorage.editorTheme) ? localStorage.editorTheme : "pastel-on-dark",
            /**上传图片相关配置如下*/
            imageUpload: true,
            imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL: "/smart-api/upload/editormdPic/"//注意你后端的上传图片服务地址
        });

        //保存操作事件
        $('#save').on('click', function () {
            articleFunction(true);

        });
        //发布文章事件
        $('#publish').on('click', function () {
            articleFunction(false);
        });
        function articleFunction(isDraft) {
            let content = document.getElementById('editormd').innerText;
            console.log(content);
            let title = $('#title').val();
            let article = {
                title,
                content,
                isDraft
            };
            $.ajax({
                url: '/saveArticle',
                data: JSON.stringify(article),
                type: 'post',
                success: function (data) {

                }
            })
        }
    });
</script>
</body>
</html>